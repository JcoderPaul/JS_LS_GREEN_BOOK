### Замена части строки в JS

В JavaScript есть несколько способов замены части строки. Рассмотрим основные методы, их особенности и лучшие практики.

### Способы замены части строки

#### 1. **Метод `replace()`**
Используется для замены первого совпадения подстроки или шаблона (регулярного выражения) на новое значение.

```javascript
const str = "Привет, мир!";
const newStr = str.replace("мир", "JavaScript");
console.log(newStr); // Привет, JavaScript!
```

**Особенности:**
- Заменяет только **первое** совпадение, если используется строка.
- Для замены всех совпадений используйте регулярное выражение с флагом `g`:
  ```javascript
  const str = "мир, мир, мир!";
  const newStr = str.replace(/мир/g, "JavaScript");
  console.log(newStr); // JavaScript, JavaScript, JavaScript!
  ```
- Поддерживает регулярные выражения, что делает его мощным для сложных замен.
- Не изменяет исходную строку, возвращает новую.

#### 2. **Метод `replaceAll()`**
Введён в ECMAScript 2021, заменяет **все** совпадения подстроки или шаблона.

```javascript
const str = "мир, мир, мир!";
const newStr = str.replaceAll("мир", "JavaScript");
console.log(newStr); // JavaScript, JavaScript, JavaScript!
```

**Особенности:**
- Прост в использовании для замены всех совпадений без регулярных выражений.
- Работает только с точными строками (для регулярных выражений используйте `replace()` с флагом `g`).
- Не изменяет исходную строку.

#### 3. **Метод `slice()` или `substring()` с конкатенацией**
Можно вырезать часть строки и заменить её, комбинируя с другими частями.

```javascript
const str = "Привет, мир!";
const index = str.indexOf("мир");
const newStr = str.slice(0, index) + "JavaScript" + str.slice(index + 3);
console.log(newStr); // Привет, JavaScript!
```

**Особенности:**
- Требует ручного определения индексов (например, с помощью `indexOf()`).
- Подходит, если нужно заменить часть строки по позиции, а не по содержимому.
- Менее удобен для сложных замен, чем `replace()` или `replaceAll()`.

#### 4. **Метод `split()` и `join()`**
Разделяет строку на массив по разделителю, заменяет элементы и соединяет обратно.

```javascript
const str = "Привет, мир!";
const newStr = str.split("мир").join("JavaScript");
console.log(newStr); // Привет, JavaScript!
```

**Особенности:**
- Эквивалентен `replaceAll()` для строк.
- Прост для понимания, но может быть менее производительным для больших строк.
- Подходит для замены всех совпадений.

#### 5. **Работа с регулярными выражениями**
Для сложных замен (например, с учётом регистра или шаблонов) используется `replace()` с регулярными выражениями.

```javascript
const str = "Привет, МИР, мир!";
const newStr = str.replace(/мир/gi, "JavaScript");
console.log(newStr); // Привет, JavaScript, JavaScript!
```

**Особенности:**
- Флаг `g` — замена всех совпадений.
- Флаг `i` — игнорирование регистра.
- Позволяет использовать сложные шаблоны, например, замену слов с определёнными символами.

### Best Practices

1. **Используйте `replaceAll()` для простых замен всех совпадений**:
   - Если требуется заменить все вхождения подстроки и вы работаете с современной средой (Node.js 15+ или новые браузеры), `replaceAll()` — самый читаемый и понятный выбор.
   - Пример: `str.replaceAll("old", "new")`.

2. **Применяйте `replace()` с регулярными выражениями для сложных случаев**:
   - Если нужно игнорировать регистр, искать по шаблону или заменить только первое совпадение, используйте `replace()` с регулярками (`/pattern/g`).
   - Пример: `str.replace(/old/gi, "new")`.

3. **Избегайте ручной работы с индексами, если возможно**:
   - Использование `slice()` или `substring()` с `indexOf()` может быть громоздким и подвержено ошибкам, особенно если строка динамическая. Предпочитайте `replace()` или `replaceAll()`.

4. **Проверяйте поддержку `replaceAll()`**:
   - Если код должен работать в старых средах (например, Node.js < 15 или старые браузеры), используйте `replace()` с флагом `g` или `split()/join()` как запасной вариант.

5. **Не мутируйте исходную строку без необходимости**:
   - Все перечисленные методы возвращают новую строку, что соответствует иммутабельности строк в JS. Если нужно сохранить исходную строку, сохраняйте результат в новую переменную.

6. **Оптимизация производительности**:
   - Для больших строк или частых замен `replaceAll()` или `replace(/pattern/g)` обычно быстрее, чем `split()/join()`.
   - Если замена выполняется многократно в цикле, кэшируйте регулярное выражение:
     ```javascript
     const regex = /мир/g;
     const newStr = str.replace(regex, "JavaScript");
     ```

7. **Читаемость и поддерживаемость**:
   - Выбирайте метод, который делает код понятным. Например, `replaceAll()` лучше для замены всех совпадений, чем `split()/join()`, из-за явного намерения.
   - Документируйте сложные регулярные выражения для ясности.

### Пример: Оптимизированная замена
```javascript
// Простая замена всех вхождений
const str = "мир, МИР, Мир!";
const result = str.replaceAll("мир", "JavaScript"); // Для точной замены
// или
const resultRegex = str.replace(/мир/gi, "JavaScript"); // Игнорировать регистр
console.log(result);      // JavaScript, JavaScript, JavaScript!
console.log(resultRegex); // JavaScript, JavaScript, JavaScript!
```

### Когда что использовать
- **Простая замена одного вхождения**: `replace("old", "new")`.
- **Замена всех вхождений**: `replaceAll("old", "new")` или `replace(/old/g, "new")`.
- **Сложные шаблоны или регистр**: `replace(/pattern/gi, "new")`.
- **Замена по позиции**: `slice()` или `substring()` с конкатенацией.
- **Простая замена всех вхождений в старых средах**: `split("old").join("new")`.