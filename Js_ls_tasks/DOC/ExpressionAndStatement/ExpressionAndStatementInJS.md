### Выражение, инструкция и выражение-инструкция в JS

В JavaScript термины **выражение** (expression), **инструкция** (statement) и **выражение-инструкция** 
(expression statement) имеют чёткие различия, которые важно понимать для написания корректного и читаемого кода. 

---

### 1. **Выражение (Expression)**
**Выражение** — это фрагмент кода, который **возвращает значение** после вычисления. Выражение всегда производит результат, 
который можно использовать в другом выражении или присвоить переменной.

#### Характеристики:
- Всегда возвращает значение (число, строка, объект, `undefined`, и т.д.).
- Может быть частью другого выражения или инструкции.
- Может использоваться в местах, где требуется значение (например, в присваивании, параметрах функции, условиях).

#### Примеры выражений:
```javascript
// Арифметическое выражение
2 + 3 // Возвращает 5

// Вызов функции
Math.random() // Возвращает случайное число

// Объект или массив
{ x: 1, y: 2 } // Возвращает объект
[1, 2, 3] // Возвращает массив

// Логическое выражение
a > b // Возвращает true или false

// Тернарный оператор
a > b ? a : b // Возвращает a или b
```

#### Особенности:
- Выражения могут быть простыми (например, `5`) или сложными (например, `(a + b) * c`).
- Выражения можно комбинировать: `a + b * c`.

---

### 2. **Инструкция (Statement)**
**Инструкция** — это фрагмент кода, который **выполняет действие**, но не обязательно возвращает значение. Инструкции составляют основную структуру программы и управляют её потоком.

#### Характеристики:
- Выполняет действие (например, объявление переменной, управление потоком, цикл).
- Не всегда возвращает значение (некоторые инструкции возвращают `undefined`).
- Обычно завершается точкой с запятой (`;`), хотя в JS автоматическая вставка точек с запятой (ASI) может срабатывать в некоторых случаях.

#### Примеры инструкций:
```javascript
// Объявление переменной
let x = 10;

// Условная инструкция
if (x > 5) {
  console.log("x больше 5");
}

// Цикл
for (let i = 0; i < 3; i++) {
  console.log(i);
}

// return
function example() {
  return 42; // Завершает функцию и возвращает значение
}

// break, continue
while (true) {
  break; // Прерывает цикл
}
```

#### Особенности:
- Инструкции часто содержат выражения (например, в `if (x > 5)` часть `x > 5` — это выражение).
- Некоторые инструкции (например, `return`) могут включать выражения, возвращающие значение.

---

### 3. **Выражение-инструкция (Expression Statement)**
**Выражение-инструкция** — это инструкция, которая состоит из **выражения**, за которым следует точка с запятой (`;`). Она выполняет выражение и использует его побочный эффект (например, вызов функции, присваивание), но само выражение может возвращать значение, которое обычно игнорируется.

#### Характеристики:
- Это выражение, которое используется как инструкция.
- Выполняется ради побочного эффекта (например, изменение переменной, вызов функции).
- Результат выражения обычно не используется (хотя технически выражение возвращает значение).

#### Примеры выражение-инструкций:
```javascript
// Присваивание
x = 5; // Выражение x = 5 возвращает 5, но используется ради присваивания

// Вызов функции
console.log("Привет"); // Выражение console.log возвращает undefined, но выводит текст

// Инкремент
x++; // Выражение x++ возвращает новое значение x, но используется ради изменения x

// Объект как выражение-инструкция
({ x: 1, y: 2 }); // Выражение возвращает объект, но ничего не делает
```

#### Особенности:
- Не все выражения могут быть выражение-инструкциями. Например, `{ x: 1 }` допустимо, но `{ let x = 1 }` вызовет ошибку, так как это блок, а не выражение.
- Выражение-инструкции часто встречаются в коде, где важен побочный эффект (например, вызов функции или изменение переменной).

---

### Как отличить или определить?
Чтобы определить, является ли фрагмент кода выражением, инструкцией или выражение-инструкцией, используйте следующие критерии:

1. **Возвращает ли значение?**
   - Если фрагмент возвращает значение, которое можно присвоить переменной или использовать в другом выражении, это **выражение**.
     ```javascript
     let result = 2 + 3; // 2 + 3 — выражение, возвращает 5
     ```
   - Если фрагмент выполняет действие, но не возвращает полезное значение, это **инструкция**.
     ```javascript
     if (true) { console.log("test"); } // if — инструкция, не возвращает значения
     ```

2. **Может ли стоять самостоятельно как строка кода?**
   - Если фрагмент может быть отдельной строкой кода, это **инструкция** или **выражение-инструкция**.
     ```javascript
     x = 5; // Выражение-инструкция
     let x = 5; // Инструкция
     ```
   - Чистые выражения (например, `2 + 3`) не могут стоять сами по себе, если их результат не используется.

3. **Побочный эффект или результат?**
   - Если код используется ради побочного эффекта (например, изменение переменной, вывод в консоль), это **выражение-инструкция**:
     ```javascript
     console.log("Привет"); // Выражение console.log выполняется ради вывода
     ```
   - Если код возвращает значение для дальнейшего использования, это **выражение**:
     ```javascript
     const sum = a + b; // a + b — выражение, результат сохраняется
     ```

4. **Контекст выполнения**:
   - **Выражения** часто встречаются внутри других конструкций (условия, параметры функций, присваивания).
     ```javascript
     if (a > b) { ... } // a > b — выражение
     ```
   - **Инструкции** управляют структурой программы (циклы, условия, объявления).
     ```javascript
     while (x < 10) { x++; } // while — инструкция, x++ — выражение-инструкция
     ```

5. **Синтаксический тест**:
   - Попробуйте использовать фрагмент в месте, где требуется значение (например, в присваивании `let x = ...`):
     - Если работает, это выражение:
       ```javascript
       let x = 2 + 3; // OK, 2 + 3 — выражение
       ```
     - Если вызывает ошибку, это инструкция:
       ```javascript
       let x = if (true) { 5 }; // SyntaxError, if — инструкция
       ```
   - Если фрагмент можно записать как отдельную строку с точкой с запятой, и он выполняет действие, это может быть выражение-инструкция:
     ```javascript
     x = 5; // OK, выражение-инструкция
     ```

---

### Примеры для сравнения
```javascript
// Выражение
const sum = 2 + 3; // 2 + 3 возвращает 5

// Инструкция
let x = 10; // Объявляет переменную, не возвращает полезное значение

// Выражение-инструкция
x = 5; // Присваивание возвращает 5, но используется ради изменения x
console.log(x); // Вызов функции возвращает undefined, но выводит x

// Комбинированный пример
if (x > 0) { // x > 0 — выражение, if — инструкция
  x += 1; // x += 1 — выражение-инструкция
}
```

---

### Особенности
1. **Автоматическая вставка точек с запятой (ASI)**:
   - JavaScript автоматически добавляет `;` после выражение-инструкций, если они записаны в отдельных строках. Но это может привести к ошибкам:
     ```javascript
     function example() {
       return // ASI добавляет ; здесь
       { x: 1 }; // Не выполняется
     }
     console.log(example()); // undefined
     ```

2. **Блочные выражения**:
   - Некоторые выражения (например, `{ x: 1 }`) могут быть выражение-инструкциями, но блоки с инструкциями (например, `{ let x = 1; }`) — нет:
     ```javascript
     ({ x: 1 }); // OK, выражение-инструкция
     { let x = 1; } // OK, блок, но не выражение
     let y = { let x = 1; }; // SyntaxError
     ```

3. **Ленивая оценка в выражениях**:
   - Логические выражения (`&&`, `||`) в выражение-инструкциях могут не вычислять второй операнд:
     ```javascript
     false && console.log("Не вызовется"); // console.log не выполнится
     ```

4. **Контекст использования**:
   - Выражения часто встречаются внутри инструкций:
     ```javascript
     while (x < 10) { // x < 10 — выражение
       x++; // x++ — выражение-инструкция
     }
     ```

---

### Best Practices

1. **Используйте скобки для ясности выражений**:
   - В сложных выражениях добавляйте скобки, чтобы явно указать порядок:
     ```javascript
     const result = (a + b) * c; // Чётко показывает порядок
     ```

2. **Разделяйте инструкции и выражения логически**:
   - Разбивайте сложные выражение-инструкции на отдельные шаги для читаемости:
     ```javascript
     // Плохо
     x = a + b * c && d || e;

     // Хорошо
     const temp = a + b * c;
     x = temp && d || e;
     ```

3. **Избегайте неоднозначных выражение-инструкций**:
   - Не пишите выражения, которые ничего не делают:
     ```javascript
     2 + 3; // Бесполезно, результат не используется
     ```

4. **Явно завершайте инструкции точкой с запятой**:
   - Хотя ASI работает в большинстве случаев, добавляйте `;` для предотвращения ошибок:
     ```javascript
     x = 5; // Явная точка с запятой
     ```

5. **Проверяйте возвращаемые значения**:
   - Если выражение-инструкция возвращает значение, подумайте, нужно ли его использовать:
     ```javascript
     const result = (x = 5); // x = 5 возвращает 5, можно использовать
     console.log(result); // 5
     ```

6. **Используйте линтеры**:
   - Инструменты вроде ESLint могут выявить бесполезные выражение-инструкции или потенциальные ошибки ASI.

7. **Разделяйте логику и побочные эффекты**:
   - Если выражение-инструкция используется ради побочного эффекта, делайте это явно:
     ```javascript
     // Хорошо
     console.log("Сообщение"); // Чёткий побочный эффект
     ```

8. **Тестируйте сложные случаи**:
   - Проверяйте поведение выражений и инструкций с разными типами данных или граничными значениями:
     ```javascript
     let x;
     x = null ?? 5; // Выражение-инструкция, возвращает 5
     console.log(x); // 5
     ```

---

### Как определить тип программно
Для определения, является ли фрагмент выражением или инструкцией, можно использовать контекст выполнения:
- **Попробуйте присвоить результат**:
  ```javascript
  let result = 2 + 3; // OK, выражение
  let result = if (true) { 5 }; // SyntaxError, инструкция
  ```
- **Проверьте в консоли**:
  - В консоли браузера или Node.js выражения возвращают значение, а инструкции — обычно `undefined`:
    ```javascript
    2 + 3 // Возвращает 5
    let x = 5 // Возвращает undefined
    ```

- **Используйте `eval` (с осторожностью)**:
  - В `eval` выражения возвращают значение, а инструкции могут вызывать ошибки или возвращать `undefined`:
    ```javascript
    console.log(eval('2 + 3')); // 5
    console.log(eval('let x = 5')); // undefined
    ```

---

### Резюме
- **Выражение**: Возвращает значение, может быть частью инструкции (например, `a + b`).
- **Инструкция**: Выполняет действие, управляет потоком программы (например, `if`, `for`, `let`).
- **Выражение-инструкция**: Выражение, используемое как инструкция ради побочного эффекта (например, `x = 5;`).
- **Как отличить**:
  - Проверяйте, возвращает ли код значение (выражение).
  - Проверяйте, можно ли использовать как самостоятельную строку (инструкция или выражение-инструкция).
  - Проверяйте контекст: выражения — в условиях/присваиваниях, инструкции — в управлении потоком.
- **Best Practices**: Используйте скобки, явные точки с запятой, избегайте бесполезных выражений, тестируйте код.